<HTML>
<HEAD>
<TITLE>Protomatter Syslog FAQ</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="stylesheet.css" TITLE="Style">
</HEAD>
<BODY>

<A name="top">

<TABLE WIDTH="100%" BORDER=0 CELLPADDING=0 CELLSPACING=0>
<TR><TD CLASS="whitetd" ALIGN="right">
<TABLE BORDER=1 CELLPADDING=4 CELLSPACING=0>
    <TR>
        <TH><A href="../../../../index.html">Main:</a></TH>
        <TH><A href="syslog-whitepaper.html">White Paper</a></TH>
        <TH>FAQ</TH>
        <TH><A href="syslog-examples.html">Examples</a></TH>
        <TH><A href="package-summary.html">JavaDoc</a></TH>
        <TH><A href="classloader-warning.html">Classloader</a></TH>
        <TH><A href="syslog-performance.html">Performance</a></TH>
    </TR>
</TABLE>
</TD></TR>
</TABLE>


<CENTER>
<H2>Protomatter Syslog FAQ</H2>
<I>Nate Sammons - January, 2003</I><BR>
<I>Covers Release 1.1.8</I>
</CENTER>
<P>


<DL>
<DT><B>Table of contents</B></DT>
<OL>
<LI> <a href="#examples">Do you have any examples of XML configuration files?</A></LI>
<LI> <a href="#classpath">I tried the code examples and they didn't compile or run.</A></LI>
<LI> <a href="#mask">I can't see any output and I'm calling <TT>.info()</TT> and <TT>.debug()</TT> logging methods.</A></LI>
<LI> <a href="#buffering">What's the story with buffering and file-related loggers?</A></LI>
<LI> <a href="#jboss">Does Syslog work with JBoss?</A></LI>
<LI> <a href="#random">Does Syslog work with &lt;insert-random-application-server-here&gt;?</A></LI>
<LI> <a href="#sax">I get an exception saying something about SAX parsers when configuring Syslog using XML files -- help!</A></LI>
<LI> <a href="#localize">What needs to be done to localize Syslog?</A></LI>
<LI> <a href="#maillog">I'm getting errors using the <TT>MailLog</TT> with MS Exchange.</A></LI>
<LI> <a href="#unix">I'm using the <tt>UNIXSyslogLog</TT> and don't see anything in <tt>/var/log/messages</TT>?</A></LI>
<LI> <a href="#unix-null">I'm using the <tt>UNIXSyslogLog</TT> and I see <tt>&lt;null&gt;</tt> in <tt>/var/log/messages</TT>?</A></LI>
</OL>
</DL>
<P>&nbsp;<P>



<OL>

<A name="examples">
<LI><B> Do you have any examples of XML configuration files?</B></LI>
<DL><DD>

Yes.  They are over <a href="syslog-examples.html">here</a>.
<P>

</DD></DL>

<P>&nbsp;<P>





<A name="classpath">
<LI><B> I tried the code examples and they didn't compile or run.</B></LI>
<DL><DD>

Make sure that the Protomatter Classes jar file
(<TT>protomatter-<i>version</I>.jar</TT>) is in your
system (or IDE's) <TT>CLASSPATH</TT> environment variable.
If it isn't there, you can't compile or run any of the examples.
<P>

</DD></DL>

<P>&nbsp;<P>





<A name="mask">
<LI><B> I can't see any output and I'm calling <TT>.info()</TT> and
    <TT>.debug()</TT> logging methods.</B></LI>
<DL><DD>

By default, Syslog ignores messages below the <TT>WARNING</TT> level.
To change this, you must reconfigure the policy.  If you don't want
to mess with config files yet, then you can put the following code
in your application:
<P>

<P><UL>
<TABLE BORDER=1 CELLPADDING=4 CELLSPACING=0><TR><TD>
<PRE>

  import com.protomatter.syslog.Syslog; &nbsp;

  ...

  Syslog.setLogMask("DEBUG");

</PRE>
</TD></TR></TABLE>
</UL></P>

This instructs Syslog to log messages at or above
the <TT>DEBUG</TT> severity.
<P>

If you're using XML configuration files, your
default Syslog configuration looks like this:

<P><UL>
<TABLE BORDER=1 CELLPADDING=4 CELLSPACING=0><TR><TD>
<PRE>

  &lt;?xml version="1.0" encoding="UTF-8"?&gt;
  &lt;Syslog defaultMask="<FONT COLOR="red">WARNING</FONT>"&gt;
    &lt;Logger name="PrintWriterLog.err" class="com.protomatter.syslog.PrintWriterLog"&gt; &nbsp;
      &lt;Format class="com.protomatter.syslog.SimpleSyslogTextFormatter"&gt;
        &lt;showChannel&gt;false&lt;/showChannel&gt;
        &lt;showThreadName&gt;false&lt;/showThreadName&gt;
        &lt;showHostName&gt;false&lt;/showHostName&gt;
        &lt;dateFormat&gt;HH:mm:ss MM/dd&lt;/dateFormat&gt;
        &lt;dateFormatCacheTime&gt;1000&lt;/dateFormatCacheTime&gt;
        &lt;dateFormatTimeZone&gt;America/Denver&lt;/dateFormatTimeZone&gt; &nbsp;
      &lt;/Format&gt;
      &lt;Policy class="com.protomatter.syslog.SimpleLogPolicy"&gt;
        &lt;channels&gt;ALL_CHANNEL&lt;/channels&gt;
        &lt;logMask&gt;<FONT COLOR="red">INHERIT_MASK</FONT>&lt;/logMask&gt; &nbsp;
      &lt;/Policy&gt;
      &lt;stream&gt;System.err&lt;/stream&gt;
    &lt;/Logger&gt;
  &lt;/Syslog&gt;

</PRE>
</TD></TR></TABLE>
</UL></P>

You can get this default configuration from Syslog by typing the
following command:<P>

<P><UL>
<TABLE BORDER=1 CELLPADDING=4 CELLSPACING=0><TR><TD>
<PRE>

  java com.protomatter.syslog.xml.SyslogXML &nbsp;

</PRE>
</TD></TR></TABLE>
</UL></P>

The areas to change are highlighted in <FONT COLOR="red">red</FONT>.  If you
change the <TT><FONT COLOR="red">WARNING</FONT></TT> value, it will affect
all loggers that have their <TT>logMask</TT> value set to <TT>INHERIT_MASK</TT>.
If you change just the <TT><FONT COLOR="red">INHERIT_MASK</FONT></TT> value,
then it just affects the logger you change it on.<P>

If you set this value to the name of a log level (<TT>DEBUG</TT>, <TT>INFO</TT>,
<TT>WARNING</TT>, <TT>ERROR</TT> or <TT>FATAL</TT>), then messages
<I>at or above</I> that level will be logged.<P>

You can also set it to a list of levels to pay attention to.  If, for example,
you set it to "<TT>=INFO,=ERROR</TT>" then only message at the <TT>INFO</TT> or
<TT>ERROR</TT> levels are logged.<P>

After saving a changed version of the configuration file, you can
configure Syslog at runtime using the file by executing the
following code in your application:

<P><UL>
<TABLE BORDER=1 CELLPADDING=4 CELLSPACING=0><TR><TD>
<PRE>

  import java.io.File;
  import com.protomatter.syslog.xml.SyslogXML;

  ...

  SyslogXML.configure(new File("filename.xml")); &nbsp;

</PRE>
</TD></TR></TABLE>
</UL></P>

If you're using an application server or a servlet container, you
may be able to use either the
<TT><A href="xml/SyslogInitServlet.html">SyslogInitServlet</A></TT> or
<TT><A href="SyslogT3Startup.html">SyslogT3Startup</A></TT> may be
able to configure Syslog when your server or WebApp initializes.

</DD></DL>

<P>&nbsp;<P>





<A name="buffering">
<LI><B> What's the story with buffering and file-related loggers?</B></LI>
<DL><DD>

In version 1.1.6 and later versions, by default each logger flushes its buffer every
time a message is sent to it.  This was <i>not</i> the case in 1.1.5,
where buffering was on by default.  Loggers that write to files
(<TT>FileLog</TT>, <TT>LengthRolloverLog</TT> and <TT>TimeRolloverLog</TT>)
can also use buffered output streams to be more efficient while writing
to files.<P>

The problem with using buffers is that if messages suddenly stop coming
into the logger (your web application gets less traffic, for instance),
it won't flush its buffer.  Maybe there's no messages in it, but maybe
there's 5 or 10 -- who knows?  There's no good way to determine if a buffer
should be flushed (because it's impossible to know that a log message
will be coming soon and that it might be better to wait 50ms before
flushing the buffer).<P>

To solve this problem, you can do a couple of things:<P>

<OL>
<LI> Add the <TT>&lt;autoFlush&gt;true&lt;/autoFlush&gt;</TT> configuration
     element to the XML configuration info for the loggers.  This will
     cause the log to be written to each time a message comes in.  This
     is the same as calling the <TT>setAutoFlush(true)</TT> method on the
     logger if you're configuring things programatically.
</LI>

<LI> Add the <TT>flushThreadInterval</TT> attribute (measured in milliseconds)
     to your XML file's <TT>&lt;Syslog&gt;</TT> element.  This has the same
     effect as calling the <TT>Syslog.setFlushThreadInterval(timeout)</TT> method.
</LI>

</OL><P>

If you choose to turn off buffering (the default) then the log will always
be completely up to date with the latest messages that have arrived.  If
you want to do buffering, using the flush thread sleep interval parameter
will cause syslog to start a background thread that continuously flushes
the buffers in all loggers and then sleeps for the number of milliseconds
you tell it to.<P>

The effect of using this is that you'll get buffered I/O to log files,
and the log will never be farther behind than the sleep interval.
Be careful not to set this value too low (below 5000 is probably not a
good idea).

</DD></DL>

<P>&nbsp;<P>





<A name="jboss">
<LI><B> Does Syslog work with JBoss?</B></LI>
<DL><DD>

Yes.  The code in the
<a href="jmx/package-summary.html"><TT>jmx</TT></A> package takes
care of loading and configuring Syslog when JBoss boots.

</DD></DL>

<P>&nbsp;<P>





<A name="random">
<LI><B> Does Syslog work with &lt;insert-random-application-server-here&gt;?</B></LI>
<DL><DD>

Almost certainly.  However, the only application server that Syslog
has a hook into is BEA WebLogic Server (using the
<TT><A href="SyslogT3Startup.html">SyslogT3Startup</A></TT>
class).
<P>

If the application server you're working with supports the idea of a
class that's loaded and run when the server starts, you should be able
to write your own Syslog initializer class to tie into your application
server.  Basically, the class should call
<TT><A href="xml/SyslogXML.html#configure(java.io.File)">SyslogXML.configure(...)</A></TT>
to configure Syslog from an XML file.<P>

If your application server supports the Servlet 2.2 specification,
then you can use the
<TT><A href="xml/SyslogInitServlet.html">SyslogInitServlet</A></TT>
to initialize syslog when a WebApp starts.  Please see the JavaDoc
for that class for more information.  Please note that even if you aren't
building a web-based application, you can still use the servlet
to configure Syslog when your app server boots.

</DD></DL>

<P>&nbsp;<P>



<A name="sax">
<LI><B> I get an exception saying something about SAX parsers when configuring Syslog using XML files -- help!</B></LI>
<DL><DD>

Sometimes, the JDom <TT>SAXBuilder</TT> class can get confused
about what parser to use -- this is generally caused by JAXP
being confused.  Anyway, it's then possible for Syslog to
try and use the wrong XML parser.  Fixing this is easy.
Just add the following command-line option when running your
application:
<P>

<P><UL>
<TABLE BORDER=1 CELLPADDING=4 CELLSPACING=0><TR><TD>
<PRE>

  java ... -DSyslog.xml.parser=org.apache.xerces.parsers.SAXParser ... &nbsp;

</PRE>
</TD></TR></TABLE>
</UL></P>

If you're using the <TT>SyslogXML.configure(File)</TT> method
to configure Syslog, you can pass the name of the
SAX parser class into that method, like this:<P>

<P><UL>
<TABLE BORDER=1 CELLPADDING=4 CELLSPACING=0><TR><TD>
<PRE>

  File file = new File("config.xml");
  SyslogXML.configure(file, "org.apache.xerces.parsers.SAXParser"); &nbsp;

</PRE>
</TD></TR></TABLE>
</UL></P>

That should fix the problem.  Every way of configuring Syslog
with XML files has a means of setting the parser class.  Check
the JavaDoc for the method you're using.

</DD></DL>

<P>&nbsp;<P>







<A name="localize">
<LI><B> What needs to be done to localize Syslog?</B></LI>
<DL><DD>

Localizing Syslog is easy -- figure out the name of your
locale (look at the JavaDoc for <TT>java.util.Locale</TT>),
and then create a file called
"<TT>com/protomatter/syslog/Syslog_<I>locale</I>.properties</TT>"
and place it in your <TT>CLASSPATH</TT>.
You should take a copy of
<TT><A href="Syslog.properties">com/protomatter/syslog/Syslog.properties</A></TT>
and translate each message into the new language.<P>

You can test your translation by using the <TT>MessageConstants</TT>
utility like this:

<P><UL>
<TABLE BORDER=1 CELLPADDING=4 CELLSPACING=0><TR><TD>
<PRE>

  java com.protomatter.syslog.MessageConstants &nbsp;

</PRE>
</TD></TR></TABLE>
</UL></P>

That program will look through all the message constants and display
their value for the current locale.  You will see output like this:<P>


<P><UL>
<TABLE BORDER=1 CELLPADDING=4 CELLSPACING=0><TR><TD>
<PRE>

  Constants class: com.protomatter.syslog.MessageConstants &nbsp;
  Locale:          en_US

  Variable name:   FLUSH_LOGGERS_MESSAGE
          value:   FlushLoggers
       property:   Flushing all loggers

  Variable name:   SHUTDOWN_SYSLOG_MESSAGE
          value:   ShutdownSyslog
       property:   Shutting down Syslog

  ...

  Variable name:   JMX_CANNOT_LOAD_FILE_MESSAGE
          value:   JMX.CannotLoadFile
       property:   {0}: Cannot load file "{1}"

</PRE>
</TD></TR></TABLE>
</UL></P>

This will allow you to debug the messages and make sure they
are all there for the new locale.


</DD></DL>

<P>&nbsp;<P>



<A name="maillog">
<LI><B> I'm getting errors using the <TT>MailLog</TT> with MS Exchange.</B></LI>
<DL><DD>

The <TT>MailLog</TT> can't talk to MS Exchange servers if they require
authentication to relay SMTP mail traffic.  You need to allow non-authenticated
SMTP connections.
<P>

</DD></DL>

<P>&nbsp;<P>





<A name="unix">
<LI><B> I'm using the <tt>UNIXSyslogLog</TT> and don't see anything in <tt>/var/log/messages</TT>?</B></LI>
<DL><DD>

This could be because of the <a href="#mask">above reason</a> about the log mask,
or it could also be that the UNIX Syslog facility isn't listening to the internet
for log packets.  You system may be different, but under Red Hat Linux 7.2,
you must specify the "<TT>-r</TT>" parameter to the startup options for the
Syslog facility.  This parameter is specified in the <TT>/etc/sysconfig/syslog</tt>
file.  If it's still not working, it may be the configuration file for the
UNIX Syslog facility -- I can't really help you there.
<P>

</DD></DL>

<P>&nbsp;<P>







<A name="unix-null">
<LI><B> I'm using the <tt>UNIXSyslogLog</TT> and I see <tt>&lt;null&gt;</tt> in <tt>/var/log/messages</TT>?</B></LI>
<DL><DD>

If you see something like this:<P>

<P><UL>
<TABLE BORDER=1 CELLPADDING=4 CELLSPACING=0><TR><TD>
<PRE>

  Apr 12 07:14:51 myhostname &lt;null&gt; SomeApp: [INFO] MyClass: blah blah &nbsp;

</PRE>
</TD></TR></TABLE>
</UL></P>


There are two parts to this.  First, <tt>&lt;null&gt;</tt> is actually
the hostname showing up twice, when the hostname isn't set.  You need
to set the <tt>hostname</tt> attribute of the <tt>&lt;Syslog&gt;</tt>
tag in your configuration file.  Next, you need to set the
<tt>&lt;showHostname&gt;</tt> parameter in your logger's configuration
to <tt>false</tt>.  If this setting is <tt>true</tt> it actually causes
the UDP packet to contain
two copies of the hostname (which is correct according to the
specification) -- on Linux at least, I found that the packet should
only contain one copy of the hostname.
<P>

</DD></DL>

<P>&nbsp;<P>







</OL>

</BODY>
</HTML>

