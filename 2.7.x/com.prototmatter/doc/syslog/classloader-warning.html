<HTML>
<HEAD>
<TITLE>Protomatter Syslog Classloader Warning Explanation</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="stylesheet.css" TITLE="Style">
</HEAD>
<BODY>

<TABLE WIDTH="100%" BORDER=0 CELLPADDING=0 CELLSPACING=0>
<TR><TD CLASS="whitetd" ALIGN="right">
<TABLE BORDER=1 CELLPADDING=4 CELLSPACING=0>
    <TR>
        <TH><A href="../../../../index.html">Main:</a></TH>
        <TH><A href="syslog-whitepaper.html">White&nbsp;Paper</a></TH>
        <TH><A href="syslog-faq.html">FAQ</a></TH>
        <TH><A href="syslog-examples.html">Examples</a></TH>
        <TH><A href="package-summary.html">JavaDoc</a></TH>
        <TH>Classloader</TH>
        <TH><A href="syslog-performance.html">Performance</a></TH>
    </TR>
</TABLE>
</TD></TR>
</TABLE>


<CENTER>
<H2>Protomatter Syslog Classloader Warning Explanation</H2>
<I>Nate Sammons - January, 2003</I><BR>
<I>Covers Release 1.1.8</I>
</CENTER>
<P>


<H3>Introduction</H3>

<P>
If you've seen a warning message like the following, this document
will be of interest to you.
</P>

<P><UL>
<TABLE BORDER=1 CELLPADDING=4 CELLSPACING=0><TR><TD><font size="-1">
<tt>
<BR>
&nbsp;/***************************************************************************\&nbsp;<BR>
&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<BR>
&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Protomatter&nbsp;Syslog&nbsp;Classloader&nbsp;Warning&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<BR>
&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--------------------------------------&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<BR>
&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<BR>
&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;Protomatter&nbsp;Syslog&nbsp;has&nbsp;been&nbsp;loaded&nbsp;by&nbsp;a&nbsp;classloader&nbsp;other&nbsp;than&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<BR>
&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;system&nbsp;classloader.&nbsp;&nbsp;This&nbsp;indicates&nbsp;that&nbsp;the&nbsp;Syslog&nbsp;libraries&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<BR>
&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;are&nbsp;not&nbsp;in&nbsp;the&nbsp;system&nbsp;CLASSPATH.&nbsp;&nbsp;Usually&nbsp;this&nbsp;is&nbsp;because&nbsp;Syslog&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<BR>
&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;being&nbsp;used&nbsp;in&nbsp;an&nbsp;application&nbsp;server&nbsp;and&nbsp;the&nbsp;Syslog&nbsp;libraries&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<BR>
&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;are&nbsp;in&nbsp;the&nbsp;"lib"&nbsp;directory&nbsp;for&nbsp;a&nbsp;WebApp&nbsp;or&nbsp;EAR,&nbsp;etc.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<BR>
&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<BR>
&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;ClassLoader:&nbsp;sun.misc.Launcher$AppClassLoader@7fdcde&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<BR>
&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<BR>
&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;Syslog&nbsp;may&nbsp;not&nbsp;work&nbsp;as&nbsp;you&nbsp;might&nbsp;expect&nbsp;if&nbsp;it&nbsp;is&nbsp;not&nbsp;loaded&nbsp;by&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<BR>
&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;system&nbsp;classloader.&nbsp;&nbsp;Under&nbsp;some&nbsp;circumstances,&nbsp;users&nbsp;may&nbsp;want&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<BR>
&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;take&nbsp;advantage&nbsp;of&nbsp;features&nbsp;of&nbsp;this&nbsp;kind&nbsp;of&nbsp;configuration.&nbsp;&nbsp;If&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<BR>
&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;this&nbsp;is&nbsp;the&nbsp;case,&nbsp;you&nbsp;can&nbsp;disable&nbsp;this&nbsp;warning&nbsp;message&nbsp;by&nbsp;setting&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<BR>
&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;"Syslog.classloader.warning"&nbsp;system&nbsp;property&nbsp;to&nbsp;"off".&nbsp;&nbsp;In&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<BR>
&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;most&nbsp;cases,&nbsp;though,&nbsp;you&nbsp;don't&nbsp;want&nbsp;to&nbsp;do&nbsp;that.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<BR>
&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<BR>
&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;For&nbsp;more&nbsp;information&nbsp;on&nbsp;this&nbsp;behavior&nbsp;and&nbsp;the&nbsp;logic&nbsp;behind&nbsp;it,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<BR>
&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;please&nbsp;see&nbsp;the&nbsp;documentation&nbsp;at&nbsp;the&nbsp;following&nbsp;address:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<BR>
&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<BR>
&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://protomatter.sourceforge.net/1.1.8/javadoc/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<BR>
&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;com/protomatter/syslog/classloader-warning.html&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<BR>
&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<BR>
&nbsp;\**************************************************************************/<BR>
<BR>
</tt></font>
</TD></TR></TABLE>
</UL></P>

<P>
So, what's the deal?  Fundamentally, the issue is that static member
variables in Java are only <i>really</i> unique within their
classloader and any "child" classloaders of that loader.
</P>

<P>
Syslog keeps its configuration information in static member
variables on the <TT><A href="Syslog.html">Syslog</A></TT>
class, meaning that Syslog is what is known as a <i>Singleton</i>
(see the book <I>Design Patterns</I> by Gamma, et al).
</P>

<P>
What can happen is that multiple copies of the Syslog classes
can get loaded, each with its own configuration, etc.  Let's say
that the application server you're using uses a hierarchy of
classloaders to do its job.  For instance, it could have one
loader for each EAR being deployed, and then one child loader for
each EJB jar and each WAR being deployed inside that EAR.
If Syslog appears in the <TT>lib</TT> directory of more than
one WAR file, and they are all loading the same configuration,
you can get corrupted log files.
</P>

<P>
Generally, what people want is one Syslog instance, with one
grand-unified configuration file for everything.  If this
is the case, you want to make sure that Syslog is loaded
from the system classloader, so that there is only one
instance of Syslog's "guts" for the entire JVM.
</P>

<P>&nbsp;</P>


<H3>Fancy Stuff</H3>

<P>
That being said, sometimes it pays to be fancy.  If you're
a hosting provider (or just a large IT shop), it may make
sense to allow each application being hosted by the server
to manage its own Syslog configuration.  This will also
ensure that there is no "cross talk" between applications
in log files.  To accomplish this, you need to make sure
that a different copy of Syslog is loaded by each EAR.
</P>

<P>
The Jar file manifest specification for JDK 1.3
(see JDK 1.3 JavaDoc) includes the <TT>Class-Path:</TT>
manifest attribute.  This is a common way of addressing
physical packaging issues with 3rd party software in
J2EE applications.
</P>

<P>
To use this feature, simply add the following to
the <TT>META-INF/MANIFEST.MF</TT> file in the EAR that
is being deployed, or in one of the EJB jar files
that is deployed in the EAR:
</P>

<P><UL>
<TABLE BORDER=1 CELLPADDING=4 CELLSPACING=0><TR><TD>
<PRE>

  Class-Path: lib/protomatter-1.1.8.jar lib&nbsp;

</PRE>
</TD></TR></TABLE>
</UL></P>

<P>
Then place the <TT>protomatter-1.1.8.jar</TT> file into
the <TT>lib</TT> directory directly under the root of the
EAR file.  This will instruct the server to include the
that file in the CLASSPATH of things loaded for that EAR file.
You can also place a <tt>syslog.xml</tt> file in the lib
directory, and the 
<TT><A href="xml/SyslogInitServlet.html">SyslogInitServlet</A></TT>
can load it using "<tt>syslog.xml</tt>" as the resource name.
</P>

<P>
At this point, we're ready to get Syslog configured for
each of those EAR apps being deployed.  The most
server-agnostic method of doing this is by using the
<TT><A href="xml/SyslogInitServlet.html">SyslogInitServlet</A></TT>
to configure syslog when a WebApp is "booted" by the
web container.
</P>

<P>
In your particular WebApp or in a new one, follow the
instuctions in <a href="xml/SyslogInitServlet.html">this JavaDoc</A>
to configure the WebApp so that the
<TT><A href="xml/SyslogInitServlet.html">SyslogInitServlet</A></TT>
is registered and configured to initialize when the
WebApp is loaded by the container.
</P>

<P>
Now what we've got is a different instance of Syslog
for each EAR being loaded by the app server.  Each
application can maintain its own Syslog configuration
and there will never be any cross-talk on log channels
between those applications.  Care should be taken to
make sure that the configurations aren't writing to
the same log files, etc, or file corruption and
general confusion can ensue.
</P>

<P>
For more information, you may want to read
<a href="http://www.onjava.com/pub/a/onjava/2001/06/26/ejb.html">EJB 2 and J2EE Packaging</a>
and
<a href="http://www.onjava.com/pub/a/onjava/2001/07/25/ejb.html">Part II</a>,
both are excellent articles by Tyler Jewell.
</P>

<P>&nbsp;</P>


<H3>Future Directions</H3>

<P>
There are roumers that a future release of the J2EE
specification will include some kind of startup/shutdown
hook in EAR file <TT>application.xml</TT> descriptors.
That would remove the need for the (somewhat hackish)
<TT><A href="xml/SyslogInitServlet.html">SyslogInitServlet</A></TT>
to configure syslog.  At that point, support for that
feature would be integrated into Syslog.
</P>

</BODY>
</HTML>
